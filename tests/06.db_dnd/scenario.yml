---
timeout: 60

tasks:
  - name: Register caller
    use: register_caller

  - name: Register callee
    use: register_callee
  
  - name: DND ACL callee
    type: mysql-client
    script: scripts/set_user_dnd.sh
    args: {{ callee }} {{ default_domain }}
    require:
      after:
        task: Register callee

  - name: Caller UAC Busy
    use: caller_uac
    config_file: scripts/caller_busy.xml
    require:
      - after:
          task: DND ACL callee
  
  - name: DND OFF ACL callee
    type: mysql-client
    script: scripts/unset_user_dnd.sh
    args: {{ callee }} {{ default_domain }}
    require:
      after:
        task: Caller UAC Busy

  - name: Caller UAC
    use: caller_uac
    require:
      - after:
          task: DND OFF ACL callee
  
  - name: Callee UAS
    use: callee_uas
    require:
      - after:
          task: DND OFF ACL callee

cleanup_tasks:
  - use: delete_caller_aor

  - use: delete_callee_aor
