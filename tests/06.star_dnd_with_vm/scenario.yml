---
timeout: 60

init_tasks:
  - name: Enable VM BUSY for callee
    use: enable_vm_callee

tasks:
  - name: Register caller
    use: register_caller

  - name: Register callee
    use: register_callee

  - name: Set Callee DND
    use: set_dnd_on
    require:
      after:
        task: Register callee

  - name: Check DND ACL
    use: check_callee_dnd_on
    require:
      after:
        task: Set Callee DND
  
  - name: Caller VM
    use: caller_uac
    config_file: scripts/caller_vm.xml
    require:
      after:
        task: Check DND ACL

  - name: Reset Callee DND
    use: set_dnd_off
    require:
      after:
        task: Caller VM

  - name: Check DND OFF ACL
    use: check_callee_dnd_off
    require:
      after:
        task: Reset Callee DND
  
  - name: Caller UAC
    use: caller_uac
    require:
      after:
        task: Check DND OFF ACL
  
  - name: Callee UAS
    use: callee_uas
    require:
      after:
        task: Check DND OFF ACL

cleanup_tasks:
  - use: delete_caller_aor
  - use: delete_callee_aor

  - name: Disable VM BUSY for callee
    use: disable_vm_callee
