---
timeout: 60

init_tasks:
  - name: Add CF Always URI for callee
    use: add_cf_uri

tasks:
  - name: Register caller
    use: register_caller

  - name: Register call forward user
    use: register_cf_user
  
  - name: Caller UAC
    use: caller_uac
    keys:
      task_tag: nocallee
    require:
      after: Register caller
      after: Register call forward user
  
  - name: CF User UAS
    use: cf_user_uas
    require:
      after: Register caller
      after: Register call forward user
  
  - name: Register Callee
    use: register_callee
    require:
      after: Caller UAC
      after: CF User UAS
  
  - name: Caller UAC 2
    use: caller_uac
    keys:
      task_tag: withcallee
    require:
      after: Register Callee
  
  - name: CF User UAS 2
    use: cf_user_uas
    require:
      after: Register Callee

cleanup_tasks:
  - use: delete_caller_aor
  - use: delete_callee_aor
  - use: delete_cf_user_aor

  - name: Remove CF Always URI for callee
    use: remove_cf_uri
